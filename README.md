# AI-XAI-LLM

## Requirements

- Python 3.8+
- Virtual environment (venv)
- LM Studio (for LLM-based explanations)
- Internet connection (for Kaggle dataset download)

## Setup Instructions

### 1. Clone or Download the Project

```bash
cd /path/to/stroke_prediction
```

### 2. Create Virtual Environment

**On Linux/Mac:**
```bash
python3 -m venv venv
source venv/bin/activate
```

**On Windows (PowerShell):**
```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
```

**On Windows (Git Bash):**
```bash
python -m venv venv
source venv/Scripts/activate
```

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

### 4. Verify Installation

**Check Python version:**
```bash
python --version
# Should show Python 3.8 or higher
```

**Verify packages installed:**
```bash
pip list
```

**Test imports:**
```bash
python -c "import sklearn, pandas, numpy, shap, imblearn; print('All imports successful!')"
``` (>=0.2.0)

### 4. Verify Installation

**Check Python version:**
```bash
python --version
# Should show Python 3.8 or higher
```

**Verify packages installed:**
```bash
pip list
```

**Test imports:**
```bash
python -c "import sklearn, pandas, numpy, shap, imblearn; print('All imports successful!')"
```

### 5. Set Up LM Studio (for Instance Explanation)

1. Download and install [LM Studio](https://lmstudio.ai/)
2. Download a compatible model (e.g., `google/gemma-3n-e4b`)
3. Start the local server:
   - Open LM Studio
   - Load the model
   - Click "Start Server" (default: http://localhost:1234)

### 6. Make Shell Scripts Executable (Linux/Mac/Git Bash)

```bash
chmod +x datapreprocessor.sh
chmod +x modeltrainer.sh
chmod +x instanceexplainer.sh
```

## Usage

### Step 1: Data Preprocessing

Run the data preprocessing script to download the dataset, perform EDA, preprocess data, create representative sample, and apply SMOTE:

**On Linux/Mac/Git Bash:**
```bash
./datapreprocessor.sh
```

**On Windows (PowerShell):**
```powershell
.\datapreprocessor.sh
# OR if you have Git Bash installed
bash datapreprocessor.sh
# OR run Python directly
python datapreprocessor.py
```

---

### Step 2: Model Training

Run the model training script to perform hyperparameter tuning, cross-validation, and train the final model:

**On Linux/Mac/Git Bash:**
```bash
./modeltrainer.sh
```

**On Windows (PowerShell):**
```powershell
.\modeltrainer.sh
# OR if you have Git Bash installed
bash modeltrainer.sh
# OR run Python directly
python modeltrainer.py
```

---

### Step 3: Instance Explanation

Run the instance explanation script to generate SHAP-based explanations and LLM-powered clinical reports for a specific patient:

**On Linux/Mac/Git Bash:**
```bash
./instanceexplainer.sh <patient_index>
```

**On Windows (PowerShell):**
```powershell
.\instanceexplainer.sh <patient_index>
# OR if you have Git Bash installed
bash instanceexplainer.sh <patient_index>
# OR run Python directly
python instanceexplainer.py <patient_index>
```

**Arguments:**
- `<patient_index>`: Integer between 0 and 14 (patient index in representative sample)

**Example:**
```bash
./instanceexplainer.sh 12
```

**Output files:**
- `reports/patient_<index>_report.txt` - Clinical stroke risk report with SHAP explanations and LLM interpretation

**Expected runtime:** 30 seconds - 2 minutes (depending on LLM response time)

**Report contents:**
- Patient demographic and clinical data
- Stroke risk prediction (High/Low) with probability
- Top 3 SHAP-contributing features
- Human-readable clinical explanation generated by LLM

**Generate reports for all patients:**

**Linux/Mac/Git Bash:**
```bash
# Generate reports for all 15 patients
for i in {0..14}; do ./instanceexplainer.sh $i; done
```

**Windows PowerShell:**
```powershell
# Generate reports for all 15 patients
0..14 | ForEach-Object { python instanceexplainer.py $_ }
```

---

## Example Workflow

```bash
# 1. Activate virtual environment
source venv/bin/activate  # Linux/Mac
# OR
.\venv\Scripts\Activate.ps1  # Windows PowerShell

# 2. Preprocess data
./datapreprocessor.sh

# 3. Train model
./modeltrainer.sh

# 4. Generate explanations for different patients
./instanceexplainer.sh 0   # First stroke patient
./instanceexplainer.sh 5   # First non-stroke patient
./instanceexplainer.sh 12  # Another patient
```

## Important Notes

**Due to cross-validation and the use of the language model, these scripts will produce slightly different results each time they are executed.**
